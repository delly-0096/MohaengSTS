package kr.or.ddit.mohaeng.mypage.notifications.service;

import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

import kr.or.ddit.mohaeng.mypage.notifications.mapper.INotiAlarmMapper;
import kr.or.ddit.mohaeng.vo.AlarmVO;
import kr.or.ddit.mohaeng.vo.PaginationInfoVO;
import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class AlarmServiceImpl implements IAlarmService {

    private final INotiAlarmMapper notiAlarmMapper;

    // 기존 페이징 목록
    @Override
    public int getAlarmCount(PaginationInfoVO<AlarmVO> pagingVO) {
        return notiAlarmMapper.selectAlarmCount(pagingVO);
    }
    // ✅ 헤더 실시간 안읽은 개수
    @Override
    public int getUnreadCount(int memNo) {
        return notiAlarmMapper.selectUnreadCount(memNo);
    }

    // ✅ 클릭 시 읽음 처리
    @Override
    public boolean readOne(int memNo, int alarmNo) {
        return notiAlarmMapper.updateReadOne(memNo, alarmNo) > 0;
    }

	  @Override
	    public List<AlarmVO> getAlarmList(PaginationInfoVO<AlarmVO> pagingVO) {
		return  notiAlarmMapper.selectAlarmList(pagingVO);
	}

	  public void testInsert(int memNo){
		    AlarmVO alarm = new AlarmVO();                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
		    alarm.setMemNo(memNo);
		    alarm.setSender("SYSTEM");
		    alarm.setAlarmType("TEST");
		    alarm.setAlarmCont("테스트 알림입니다.");
		    alarm.setMoveUrl("/mypage");
		    alarm.setReadYn("N");

		    notiAlarmMapper.insertAlarm(alarm);
		}
	  @Override
	  public int countUnread(int memNo) {

		return 0;
	  }
	  @Override
	  public List<AlarmVO> selectAlramList(int memNo) {
		return notiAlarmMapper.selectAlramList(memNo);
	  }
	  @Override
	  public void readAll(int memNo) {
		  notiAlarmMapper.updateAllRead(memNo);
		
	  }
	  @Override
	  public boolean readOne(Map<String, Object> param) {
		    return notiAlarmMapper.updateReadOne(param) > 0;
		}
	  @Override
	  public void readAll(Map<String, Object> param) {
	      notiAlarmMapper.updateAllRead(param);
	  }



}
