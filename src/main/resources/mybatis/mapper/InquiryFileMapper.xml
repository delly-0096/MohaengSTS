<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mohaeng.support.inquiry.mapper.IInquiryFileMapper">

	 <!-- ATTACH_FILE 마스터 생성 -->
    <insert id="insertAttachFile" parameterType="kr.or.ddit.mohaeng.vo.InquiryFileVO">
        <selectKey keyProperty="attachNo" resultType="int" order="BEFORE">
            SELECT ATTACH_FILE_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO ATTACH_FILE (
            ATTACH_NO,
            REG_ID,
            REG_DT
        ) VALUES (
            #{attachNo},
            #{regId},
            SYSDATE
        )
    </insert>

    <!-- ATTACH_FILE_DETAIL 파일 상세 저장 -->
    <insert id="insertFileDetail" parameterType="kr.or.ddit.mohaeng.vo.InquiryFileVO">
        <selectKey keyProperty="fileNo" resultType="int" order="BEFORE">
            SELECT ATTACH_FILE_DETAIL_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO ATTACH_FILE_DETAIL (
            ATTACH_NO,
            FILE_NO,
            FILE_NAME,
            FILE_ORIGINAL_NAME,
            FILE_EXT,
            FILE_SIZE,
            FILE_PATH,
            FILE_CD,
            MIME_TYPE,
            USE_YN,
            REG_ID,
            REG_DT
        ) VALUES (
            #{attachNo},
            #{fileNo},
            #{fileName},
            #{fileOriginalName},
            #{fileExt},
            #{fileSize},
            #{filePath},
            'INQUIRY',
            #{mimeType},
            #{useYn},
            #{regId},
            SYSDATE
        )
    </insert>

    <!-- 파일 목록 조회 -->
    <select id="selectFileList" parameterType="int"
            resultType="kr.or.ddit.mohaeng.vo.InquiryFileVO">
        SELECT
            ATTACH_NO as attachNo,
            FILE_NO as fileNo,
            FILE_NAME as fileName,
            FILE_ORIGINAL_NAME as fileOriginalName,
            FILE_EXT as fileExt,
            FILE_SIZE as fileSize,
            FILE_PATH as filePath,
            MIME_TYPE as mimeType,
            USE_YN as useYn
        FROM ATTACH_FILE_DETAIL
        WHERE ATTACH_NO = #{attachNo}
        AND USE_YN = 'Y'
        ORDER BY FILE_NO
    </select>

    <!-- 단일 파일 조회 -->
    <select id="selectFile" parameterType="int"
            resultType="kr.or.ddit.mohaeng.vo.InquiryFileVO">
        SELECT
            ATTACH_NO as attachNo,
            FILE_NO as fileNo,
            FILE_NAME as fileName,
            FILE_ORIGINAL_NAME as fileOriginalName,
            FILE_EXT as fileExt,
            FILE_SIZE as fileSize,
            FILE_PATH as filePath,
            MIME_TYPE as mimeType
        FROM ATTACH_FILE_DETAIL
        WHERE FILE_NO = #{fileNo}
        AND USE_YN = 'Y'
    </select>
</mapper>