<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mohaeng.support.faq.mapper.IFaqMapper">

	<select id="selectAdminInquiryList" parameterType="map" resultType="kr.or.ddit.mohaeng.vo.InquiryVO">
		SELECT
	         i.INQRY_NO
	        ,i.INQRY_CTGRY_CD
	        ,i.INQRY_STATUS
	        ,i.INQRY_TITLE
	        ,i.INQRY_EMAIL
	        ,i.REG_DT
	        ,i.DEL_YN
	        ,c.CD_NAME     AS categoryName
	        ,m.MEM_NAME    AS memberName
	        ,m.MEM_ID

	    FROM INQUIRY i
	    LEFT JOIN CODE c
	           ON i.INQRY_CTGRY_CD = c.CD
	          AND c.CDGR = 'INQRY_CAT'
	          AND c.USE_YN = 'Y'
	    LEFT JOIN MEMBER m
	           ON i.MEM_NO = m.MEM_NO

	    WHERE i.DEL_YN = 'N'

		<!--키워드 검색  -->
		<if test="searchKeyword != null and searchKeyword != ''">
			 AND (
	               i.INQRY_TITLE LIKE '%' || #{searchKeyword} || '%'
	            OR m.MEM_NAME    LIKE '%' || #{searchKeyword} || '%'
	            OR m.MEM_ID      LIKE '%' || #{searchKeyword} || '%'
	            OR i.INQRY_EMAIL LIKE '%' || #{searchKeyword} || '%'
	        )
		</if>

		<!--상태 필터 -->
		<if test="status !=null and status != 'all'">
			AND i.INQRY_STATUS = #{status}
		</if>

		<!--카테고리 필터-->
		<if test="category !=null and category !='all'">
			AND i.INQRY_CTGRY_CD = #{category}
		</if>

		ORDER BY i.REG_DT DESC
		OFFSET #{offset} ROWS
		FETCH NEXT #{pageSize} ROWS ONLY
	</select>

	<!--관리자 문의 총 개수 조회 (목록용 카운트)  -->
	<select id="selectAdminInquiryCount" resultMap="map" resultType="int">
		select
			count(*)
		from INQUIRY i
		LEFT JOIN MEMBER m
			   ON i.MEM_NO=m.MEM_NO
		where i.DEL_YN = 'N'
		<!--키워드 검색 -->
		<!--상태 필터 -->
		<!--카테고리 필터  -->


	</select>
</mapper>