<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mohaeng.login.mapper.IMemberMapper">

	<resultMap type="kr.or.ddit.mohaeng.vo.MemberVO" id="memberMap">
		<id property="memNo" column="MEM_NO"/>
		<result property="memNo" column="MEM_NO"/>
		<result property="memId" column="MEM_ID"/>
		<result property="memPassword" column="MEM_PASSWORD"/>
		<result property="memName" column="MEM_NAME"/>
		<result property="memEmail" column="MEM_EMAIL"/>
		<result property="memProfile" column="MEM_PROFILE"/>
		<result property="point" column="POINT"/>
		<result property="memStatus" column="MEM_STATUS"/>
		<result property="delYn" column="DEL_YN"/>
		<result property="wdrwResn" column="WDRW_RESN"/>
		<result property="enabled" column="ENABLED"/>
		<result property="memSnsYn" column="MEM_SNS_YN"/>
		<result property="snsType" column="SNS_TYPE"/>
		<result property="snsId" column="SNS_ID"/>
		<result property="regDt" column="REG_DT"/>
		<result property="udtDt" column="UDT_DT"/>
		<result property="wdrwDt" column="WDRW_DT"/>
		<collection property="authList" resultMap="authMap"/>
	</resultMap>

    <resultMap type="kr.or.ddit.mohaeng.vo.MemberAuthVO" id="authMap">
		<result property="memAuthNo" column="MEM_AUTH_NO"/>
		<result property="memNo" column="MEM_NO"/>
		<result property="auth" column="AUTH"/>
		<result property="regDt" column="REG_DT"/>
	</resultMap>
	
	<!-- 로그인 시 id 매핑 -->
	<select id="selectByMemId" parameterType="string" resultType="kr.or.ddit.mohaeng.vo.MemberVO">
		SELECT MEM_NO as memNo,
		       MEM_ID as memId,
		       MEM_PASSWORD as memPassword,
		       MEM_NAME as memName
		FROM MEMBER
		WHERE MEM_ID = #{memId}
    </select>
    
    <!-- security & jwt용 id 매핑 -->
    <select id="selectById" parameterType="string" resultMap="memberMap">
    	SELECT M.MEM_NO, MEM_ID, MEM_PASSWORD, MEM_NAME, AUTH
    	  FROM MEMBER M LEFT OUTER JOIN MEMBER_AUTH MA ON(M.MEM_NO = MA.MEM_NO)
    	 WHERE M.MEM_ID = #{username}
    </select>
    
    <!-- 회원가입 -->
    <insert id="insertMember" parameterType="kr.or.ddit.mohaeng.vo.MemberVO">
    	<selectKey keyProperty="memNo" resultType="int" order="BEFORE">
    		SELECT SEQ_MEMBER_NO.NEXTVAL FROM dual
    	</selectKey>
    	
		 INSERT INTO MEMBER
		    (MEM_NO, MEM_ID, MEM_PASSWORD, MEM_NAME, MEM_EMAIL
		    , MEM_PROFILE, POINT, MEM_STATUS, DEL_YN, WDRW_RESN
		    , ENABLED, MEM_SNS_YN, SNS_TYPE, SNS_ID, REG_DT, UDT_DT, WDRW_DT)
		VALUES
		    ( #{memNo}, #{memId}, #{memPassword}, #{memName}, #{memEmail}
		    , NULL, 0, 'ACTIVE', 'N', NULL
		    , 1, 'N', NULL, NULL, SYSDATE, NULL, NULL )

    		
    </insert>
    
    <!-- 일반회원 권한 저장 -->
	<insert id="insertAuth" parameterType="kr.or.ddit.mohaeng.vo.MemberAuthVO">
	
	    INSERT INTO MEMBER_AUTH (
	        MEM_AUTH_NO, MEM_NO, AUTH, REG_DT
	    ) VALUES (
	        SEQ_MEMBER_AUTH_NO.NEXTVAL, #{memNo}, 'MEMBER', SYSDATE
	    )
	</insert>
	
	<!-- 일반회원 정보 저장 -->
	<insert id="insertUser" parameterType="kr.or.ddit.mohaeng.vo.MemUserVO">
    INSERT INTO MEM_USER (
        MEM_NO, NICKNAME, BIRTH_DATE, GENDER, ZIP, ADDR1, ADDR2, TEL
    ) VALUES (
        #{memNo}, #{memUser.nickname}, #{memUser.birthDate}, #{memUser.gender}, #{memUser.zip}, #{memUser.addr1}, #{memUser.addr2}, #{memUser.tel}
    )
	</insert>
	
	<!-- 아이디 중복 체크 -->
	<select id="idCheck" parameterType="string" resultType="kr.or.ddit.mohaeng.vo.MemberVO">
		SELECT MEM_NO, MEM_ID
		  FROM MEMBER
		 WHERE MEM_ID = #{memId}
	</select>
	
    
    
</mapper>